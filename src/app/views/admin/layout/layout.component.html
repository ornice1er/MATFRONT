<div class="min-h-screen! bg-gray-50! flex!">
  <!-- Sidebar -->
  <div [class]="' flex! flex-col! 2xl:gap-3! transition-all! duration-300! bg-gradient-to-b! from-indigo-900! via-purple-900! to-indigo-800! text-white! shadow-2xl! relative! ' + (menuOpen ? 'w-64!' : 'w-16!')">
    <div class="p-6!">
      <button
        (click)="menuOpen=!menuOpen"
        class="absolute! top-6! right-4! p-2! rounded-lg! bg-white/10! hover:bg-white/20! transition-colors!"
      >
        <lucide-angular [img]="menuOpen ? xIcon : menuIcon" size="20"></lucide-angular>
      </button>

      <div *ngIf="menuOpen" class="mb-8!">
        <h1 class="text-xl! font-bold! text-white/90!">MATACCUEIL</h1>
        <p class="text-sm! text-white/70! mt-1!">Administration</p>
      </div>
    </div>

    <nav class="" [ngClass]="{'px-1! pb-6': !menuOpen, 'px-4! py-6!': menuOpen}">
      <div *ngFor="let item of menuItems" class="mb-1!">
        <button *ngIf="canShowItem(item)" routerLinkActive="bg-white/20! text-white! shadow-lg!" (click)="onNavItemClick(item)"
          class="w-full! flex! items-center! justify-between! px-4! py-3! rounded-xl! transition-all! duration-200! group! text-white/80! hover:bg-white/10! hover:text-white!">
          <div class="flex! items-center! space-x-3!">
            <span *ngIf="!menuOpen" class="text-xl! font-semibold!">{{item.label.charAt(0) | uppercase}}{{item.label.charAt(1) | uppercase}}</span>
            <span *ngIf="menuOpen" class="text-sm! font-medium!">{{ item.label }}</span>
          </div>
          <lucide-angular
            *ngIf="menuOpen && item.children && item.children.length > 0"
            [img]="chevronRightIcon"
            size="16"
            [class]="'transition-transform! duration-200! ' + (expandedMenus().has(item.label) ? 'rotate-90!' : '')"
          ></lucide-angular>
        </button>

        <div *ngIf="item.children && item.children.length > 0 && expandedMenus().has(item.label) && menuOpen && canShowItemBloc(item)" class="ml-4! mt-2! space-y-1!">
          <button *ngFor="let child of item.children" routerLinkActive="bg-white/20! text-white! shadow-lg!" [routerLink]="child.route" [hidden]="!canShowItem(child)" class="w-full! text-left! px-4! py-2! text-sm! text-white/70! hover:text-white! hover:bg-white/5! rounded-lg! transition-colors!">
            {{child.label}}
          </button>
        </div>
      </div>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="flex-1! overflow-hidden!">
    <!-- Header -->
    <header class="bg-mat-primary! shadow-sm! border-b! border-gray-200! px-8! py-2!">
      <div class="flex! items-center! justify-between!">
        <div class="flex! flex-col! gap-0! space-0">
          <h1 class="text-2xl! font-bold! text-white!">
            {{!menuOpen?'MATACCUEIL |':''}} {{title}}
          </h1>
        </div>

        <div class="flex! items-center! space-x-4!">
          <!-- Bouton pour ouvrir le menu déroulant -->
          <button (click)="op.toggle($event)"
            class="flex! items-center! space-x-2! px-4! py-2! bg-white/10! text-white! rounded-lg! transition-colors! hover:bg-white/20!">
            <div class="avatar! bg-white/20! flex! items-center! justify-center!">
              <lucide-angular [img]="userIcon" size="18"></lucide-angular>
            </div>
            <div class="hidden! md:block!">
              <div class="username! text-sm!">{{ user?.email }}</div>
              <div class="text-white/70! text-xs!">{{ user?.name || user?.agent_user?.nomprenoms || 'Non défini' }}</div>
            </div>
            <lucide-angular [img]="chevronDownIcon" size="16" class="text-white/70!"></lucide-angular>
          </button>

          <!-- Menu déroulant -->
          <p-overlayPanel #op>
            <div class="menu-header! bg-white! rounded-xl! shadow-lg! w-full! max-w-[25rem]!">
              <!-- En-tête du menu -->
              <div class="flex! items-center! gap-x-4!">
                <div class="avatar! bg-mat-primary! flex! items-center! justify-center!">
                  <lucide-angular [img]="userIcon" size="20" class="text-white!"></lucide-angular>
                </div>
                <div>
                  <div class="font-semibold! text-sm! text-gray-900!">{{ user?.email }}</div>
                  <div class="text-blueColor! text-xs!">{{ user?.name || user?.agent_user?.nomprenoms || 'Non défini' }}</div>
                </div>
              </div>
              <hr class="my-2!">
              <!-- Options du menu -->
              <div class="flex! flex-col! gap-1! p-4!">
                <!-- Bouton Déconnexion -->
                <button (click)="logout()"
                  class="flex! items-center! gap-x-2! py-2! px-3! w-full! justify-start! text-gray-600! hover:text-blueColor! hover:bg-blueColor/10! rounded-lg! transition-colors!">
                  <lucide-angular [img]="logOutIcon" size="16"></lucide-angular>
                  <span>Déconnexion</span>
                </button>
              </div>
            </div>
          </p-overlayPanel>
        </div>
      </div>
    </header>

    <!-- Dashboard Content -->
    <main class="overflow-y-auto! p-3!">
      <router-outlet></router-outlet>
    </main>
  </div>
</div>
